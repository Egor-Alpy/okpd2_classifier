# Файл: src/services/prompts.py
# Новый файл с оптимизированными промптами

class OptimizedPromptBuilder:
    """Оптимизированные промпты для экономии токенов"""

    # Сокращенный список основных классов с ключевыми словами
    OKPD2_CLASSES_COMPACT = {
        "01": "Сельхозпродукция",
        "02": "Лесная продукция",
        "03": "Рыба, морепродукты",
        "05": "Уголь",
        "06": "Нефть, газ",
        "07": "Металлические руды",
        "08": "Прочие полезные ископаемые",
        "10": "Пищевые продукты",
        "11": "Напитки",
        "12": "Табак",
        "13": "Текстиль",
        "14": "Одежда",
        "15": "Кожа, обувь",
        "16": "Древесина, изделия из дерева",
        "17": "Бумага",
        "18": "Печатные услуги",
        "19": "Нефтепродукты",
        "20": "Химические продукты",
        "21": "Лекарства, медицина",
        "22": "Резина, пластмасса",
        "23": "Стройматериалы неметаллические",
        "24": "Металлы",
        "25": "Металлоизделия",
        "26": "Компьютеры, электроника, оптика",
        "27": "Электрооборудование",
        "28": "Машины и оборудование",
        "29": "Автотранспорт",
        "30": "Прочий транспорт",
        "31": "Мебель",
        "32": "Прочие готовые изделия",
        "33": "Ремонт оборудования",
        "35": "Электроэнергия, газ",
        "36": "Водоснабжение",
        "38": "Утилизация отходов",
        "41": "Строительство зданий",
        "42": "Инженерные сооружения",
        "43": "Специализированные строительные работы",
        "45": "Торговля автотранспортом",
        "46": "Оптовая торговля",
        "47": "Розничная торговля",
        "49": "Наземный транспорт",
        "50": "Водный транспорт",
        "51": "Воздушный транспорт",
        "52": "Складирование",
        "53": "Почта, курьерские услуги",
        "55": "Гостиницы",
        "56": "Общепит",
        "58": "Издательская деятельность",
        "59": "Кино, видео",
        "60": "Теле-радиовещание",
        "61": "Телекоммуникации",
        "62": "Программное обеспечение",
        "63": "ИТ-услуги",
        "64": "Финансовые услуги",
        "65": "Страхование",
        "68": "Недвижимость",
        "69": "Юридические, бухгалтерские услуги",
        "70": "Консалтинг",
        "71": "Архитектура, инжиниринг",
        "72": "Научные исследования",
        "73": "Реклама, маркетинг",
        "74": "Прочие профессиональные услуги",
        "75": "Ветеринарные услуги",
        "77": "Аренда, лизинг",
        "78": "Трудоустройство",
        "79": "Туризм",
        "80": "Безопасность, охрана",
        "81": "Обслуживание зданий",
        "82": "Административные услуги",
        "84": "Госуправление",
        "85": "Образование",
        "86": "Здравоохранение",
        "87": "Социальный уход",
        "88": "Социальные услуги",
        "90": "Культура, развлечения",
        "91": "Библиотеки, музеи",
        "92": "Азартные игры",
        "93": "Спорт, отдых",
        "94": "Общественные организации",
        "95": "Ремонт бытовой техники",
        "96": "Персональные услуги"
    }

    @staticmethod
    def build_stage_one_prompt_optimized(products: List[str]) -> str:
        """Оптимизированный промпт для первого этапа"""
        products_text = "\n".join(products[:50])  # Ограничиваем количество товаров

        # Формируем компактный список классов
        classes_text = "\n".join(
            [f"{code} - {name}" for code, name in OptimizedPromptBuilder.OKPD2_CLASSES_COMPACT.items()])

        prompt = f"""Определи основные классы ОКПД2 (первые 2 цифры) для товаров.

ПРАВИЛА:
1. Для каждого товара укажи ВСЕ подходящие классы
2. Если товар относится к нескольким классам - укажи через |
3. Формат: "Название товара|XX" или "Название товара|XX|YY"
4. Если не подходит ни один класс - не выводи товар

КЛАССЫ ОКПД2:
{classes_text}

ТОВАРЫ:
{products_text}"""

        return prompt