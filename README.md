# –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ –û–ö–ü–î2 v2

## üîÑ –ò–∑–º–µ–Ω–µ–Ω–∏—è –≤ –ª–æ–≥–∏–∫–µ

### –ü–µ—Ä–≤—ã–π —ç—Ç–∞–ø: –¢–æ–ø-5 –≥—Ä—É–ø–ø
–¢–µ–ø–µ—Ä—å –≤–º–µ—Å—Ç–æ –ø–æ–∏—Å–∫–∞ –í–°–ï–• –ø–æ–¥—Ö–æ–¥—è—â–∏—Ö –≥—Ä—É–ø–ø, —Å–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç **–¢–û–ü-5 –Ω–∞–∏–±–æ–ª–µ–µ —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω—ã—Ö –≥—Ä—É–ø–ø** –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —Ç–æ–≤–∞—Ä–∞:

- –ì—Ä—É–ø–ø—ã —É–ø–æ—Ä—è–¥–æ—á–µ–Ω—ã –ø–æ —É–±—ã–≤–∞–Ω–∏—é —Ä–µ–ª–µ–≤–∞–Ω—Ç–Ω–æ—Å—Ç–∏
- –ü–µ—Ä–≤–∞—è –≥—Ä—É–ø–ø–∞ - —Å–∞–º–∞—è –ø–æ–¥—Ö–æ–¥—è—â–∞—è
- –û—Å—Ç–∞–ª—å–Ω—ã–µ - –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –≤–∞—Ä–∏–∞–Ω—Ç—ã –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ï—Å–ª–∏ —Ç–æ–≤–∞—Ä —è–≤–Ω–æ –ø–æ–¥—Ö–æ–¥–∏—Ç —Ç–æ–ª—å–∫–æ –ø–æ–¥ 1-2 –≥—Ä—É–ø–ø—ã, —É–∫–∞–∑—ã–≤–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –æ–Ω–∏

**–ü—Ä–∏–º–µ—Ä —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞ –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞:**
```json
{
  "title": "–ü—Ä–∏–Ω—Ç–µ—Ä –ª–∞–∑–µ—Ä–Ω—ã–π —Å —Ñ—É–Ω–∫—Ü–∏–µ–π —Å–∫–∞–Ω–µ—Ä–∞",
  "okpd_group": ["26.20.4", "28.23.2", "26.20.3", "26.30.1", "26.20.1"]
}
```

### –í—Ç–æ—Ä–æ–π —ç—Ç–∞–ø: –ï–¥–∏–Ω—ã–π —Ç–æ—á–Ω—ã–π –∫–æ–¥
–ù–∞ –≤—Ç–æ—Ä–æ–º —ç—Ç–∞–ø–µ —Å–∏—Å—Ç–µ–º–∞:

1. –ë–µ—Ä–µ—Ç –í–°–ï —Ç–æ–ø-5 –≥—Ä—É–ø–ø —Ç–æ–≤–∞—Ä–∞
2. –ò–∑–≤–ª–µ–∫–∞–µ—Ç –í–°–ï –∫–æ–¥—ã-–ø—Ä–æ–¥–æ–ª–∂–µ–Ω–∏—è –∏–∑ —ç—Ç–∏—Ö –≥—Ä—É–ø–ø
3. –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –≤—Å–µ –∫–æ–¥—ã –≤ –æ–¥–∏–Ω –ø—Ä–æ–º–ø—Ç
4. –í—ã–±–∏—Ä–∞–µ—Ç –û–î–ò–ù —Å–∞–º—ã–π —Ç–æ—á–Ω—ã–π –∫–æ–¥ –∏–∑ –≤—Å–µ—Ö –≤–µ—Ç–æ–∫

**–ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞:**
- –ë–æ–ª—å—à–µ —à–∞–Ω—Å–æ–≤ –Ω–∞–π—Ç–∏ —Ç–æ—á–Ω—ã–π –∫–æ–¥
- –°—Ä–∞–≤–Ω–µ–Ω–∏–µ –∫–æ–¥–æ–≤ –∏–∑ —Ä–∞–∑–Ω—ã—Ö –≤–µ—Ç–æ–∫
- –í—ã–±–æ—Ä –Ω–∞–∏–±–æ–ª–µ–µ —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω–æ–≥–æ –∫–æ–¥–∞

## üì¶ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö

### 1. –ü–æ–¥–≥–æ—Ç–æ–≤—å—Ç–µ —Ñ–∞–π–ª –û–ö–ü–î2 –≤ —Ñ–æ—Ä–º–∞—Ç–µ CSV
–§–∞–π–ª –¥–æ–ª–∂–µ–Ω —Å–æ–¥–µ—Ä–∂–∞—Ç—å –∫–æ–ª–æ–Ω–∫–∏:
- `–ö–æ–¥` - –∫–æ–¥ –û–ö–ü–î2
- `–ù–∞–∏–º–µ–Ω–æ–≤–∞–Ω–∏–µ` - –æ–ø–∏—Å–∞–Ω–∏–µ

### 2. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ —Ñ–∞–π–ª—ã –¥–∞–Ω–Ω—ã—Ö
```bash
make prepare-data CSV=okpd2.csv
```

–≠—Ç–æ —Å–æ–∑–¥–∞—Å—Ç –¥–≤–∞ —Ñ–∞–π–ª–∞:
- `src/data/okpd2_5digit_groups.txt` - —Å–ø–∏—Å–æ–∫ 5-–∑–Ω–∞—á–Ω—ã—Ö –≥—Ä—É–ø–ø –¥–ª—è –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞
- `src/data/okpd2_full_tree.json` - –ø–æ–ª–Ω–æ–µ –¥–µ—Ä–µ–≤–æ –û–ö–ü–î2 –¥–ª—è –≤—Ç–æ—Ä–æ–≥–æ —ç—Ç–∞–ø–∞

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª—ã
```bash
make verify-data
```

## üöÄ –ó–∞–ø—É—Å–∫ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏

### –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç
```bash
# 1. –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö
make verify-data

# 2. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
make init-db

# 3. –ó–∞–ø—É—Å–∫ –º–∏–≥—Ä–∞—Ü–∏–∏
make migration-start API_KEY=your-key

# 4. –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–∞ –º–∏–≥—Ä–∞—Ü–∏–∏
make migration-worker

# 5. –ó–∞–ø—É—Å–∫ –≤–æ—Ä–∫–µ—Ä–æ–≤ –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞
make worker-stage1    # –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
make worker-stage1-2  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤—Ç–æ—Ä–æ–π –≤–æ—Ä–∫–µ—Ä

# 6. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞
make monitor

# 7. –ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞ - –∑–∞–ø—É—Å–∫ –≤—Ç–æ—Ä–æ–≥–æ
make worker-stage2    # –í –æ—Ç–¥–µ–ª—å–Ω–æ–º —Ç–µ—Ä–º–∏–Ω–∞–ª–µ
make worker-stage2-2  # –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ, –≤—Ç–æ—Ä–æ–π –≤–æ—Ä–∫–µ—Ä

# 8. –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –≤—Ç–æ—Ä–æ–≥–æ —ç—Ç–∞–ø–∞
make stage2-stats
```

### –ü–æ–ª–Ω—ã–π —Ü–∏–∫–ª –æ–¥–Ω–æ–π –∫–æ–º–∞–Ω–¥–æ–π
```bash
make full-cycle API_KEY=your-key
```

## üìä –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞
```bash
make stats
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –û–±—â–µ–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö (—Å —Ç–æ–ø-5 –≥—Ä—É–ø–ø–∞–º–∏)
- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –Ω–µ–∫–ª–∞—Å—Å–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö

### –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –≤—Ç–æ—Ä–æ–≥–æ —ç—Ç–∞–ø–∞
```bash
make stage2-stats
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç:
- –¢–æ–≤–∞—Ä—ã —Å —Ç–æ—á–Ω—ã–º–∏ –∫–æ–¥–∞–º–∏
- –¢–æ–≤–∞—Ä—ã –±–µ–∑ —Ç–æ—á–Ω—ã—Ö –∫–æ–¥–æ–≤
- –ü—Ä–æ—Ü–µ–Ω—Ç –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è

### –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –≥—Ä—É–ø–ø
```bash
make group-distribution
```
–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Å–∫–æ–ª—å–∫–æ —Ç–æ–≤–∞—Ä–æ–≤ –∏–º–µ—é—Ç 1, 2, 3, 4 –∏–ª–∏ 5 –≥—Ä—É–ø–ø.

## üîß –ù–∞—Å—Ç—Ä–æ–π–∫–∞

### –†–∞–∑–º–µ—Ä—ã –±–∞—Ç—á–µ–π
–í `.env` —Ñ–∞–π–ª–µ:
```bash
# –ü–µ—Ä–≤—ã–π —ç—Ç–∞–ø - –º–æ–∂–Ω–æ –±–æ–ª—å—à–µ
CLASSIFICATION_BATCH_SIZE=50

# –í—Ç–æ—Ä–æ–π —ç—Ç–∞–ø –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–º–µ–Ω—å—à–∏—Ç –¥–æ 15
# –∏–∑-–∑–∞ –±–æ–ª—å—à–µ–≥–æ —Ä–∞–∑–º–µ—Ä–∞ –ø—Ä–æ–º–ø—Ç–∞
```

### Rate limiting
```bash
RATE_LIMIT_DELAY=10  # –ó–∞–¥–µ—Ä–∂–∫–∞ –º–µ–∂–¥—É –±–∞—Ç—á–∞–º–∏
MAX_RETRIES=3        # –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–ø—ã—Ç–æ–∫
```

## üìà –û–∂–∏–¥–∞–µ–º—ã–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã

### –ü–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞
- ~95% —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—É—á–∞—Ç –æ—Ç 1 –¥–æ 5 –≥—Ä—É–ø–ø
- –ë–æ–ª—å—à–∏–Ω—Å—Ç–≤–æ —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—É—á–∞—Ç 2-3 –≥—Ä—É–ø–ø—ã
- –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã - 1 –≥—Ä—É–ø–ø—É
- –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–µ —Ç–æ–≤–∞—Ä—ã - 4-5 –≥—Ä—É–ø–ø

### –ü–æ—Å–ª–µ –≤—Ç–æ—Ä–æ–≥–æ —ç—Ç–∞–ø–∞
- ~70-80% —Ç–æ–≤–∞—Ä–æ–≤ –ø–æ–ª—É—á–∞—Ç —Ç–æ—á–Ω—ã–π –∫–æ–¥
- –û—Å—Ç–∞–ª—å–Ω—ã–µ –±—É–¥—É—Ç –ø–æ–º–µ—á–µ–Ω—ã –∫–∞–∫ "none_classified"
- –≠—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ - –Ω–µ –¥–ª—è –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤ –µ—Å—Ç—å —Ç–æ—á–Ω—ã–µ –∫–æ–¥—ã

## üõ†Ô∏è –û–±—Ä–∞–±–æ—Ç–∫–∞ –ø—Ä–æ–±–ª–µ–º

### –°–±—Ä–æ—Å failed —Ç–æ–≤–∞—Ä–æ–≤
```bash
# –ü–µ—Ä–≤—ã–π —ç—Ç–∞–ø
make reset-failed-stage1

# –í—Ç–æ—Ä–æ–π —ç—Ç–∞–ø
make reset-failed-stage2
```

### –û—á–∏—Å—Ç–∫–∞ –∑–∞—Å—Ç—Ä—è–≤—à–∏—Ö —Ç–æ–≤–∞—Ä–æ–≤
```bash
make cleanup-stuck
make reset-processing-stage2
```

## üìù –ü—Ä–∏–º–µ—Ä—ã —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### –¢–æ–≤–∞—Ä –ø–æ—Å–ª–µ –ø–µ—Ä–≤–æ–≥–æ —ç—Ç–∞–ø–∞:
```json
{
  "_id": "...",
  "title": "–ù–æ—É—Ç–±—É–∫ HP ProBook 450 G8",
  "okpd_group": ["26.20.1", "26.20.3", "26.20.2"],
  "status_stage1": "classified",
  "status_stage2": "pending"
}
```

### –¢–æ–≤–∞—Ä –ø–æ—Å–ª–µ –≤—Ç–æ—Ä–æ–≥–æ —ç—Ç–∞–ø–∞:
```json
{
  "_id": "...",
  "title": "–ù–æ—É—Ç–±—É–∫ HP ProBook 450 G8",
  "okpd_group": ["26.20.1", "26.20.3", "26.20.2"],
  "status_stage1": "classified",
  "status_stage2": "classified",
  "okpd2_code": "26.20.11.110",
  "okpd2_name": "–ö–æ–º–ø—å—é—Ç–µ—Ä—ã –ø–æ—Ä—Ç–∞—Ç–∏–≤–Ω—ã–µ –º–∞—Å—Å–æ–π –Ω–µ –±–æ–ª–µ–µ 10 –∫–≥"
}
```

## üîç Docker –∫–æ–º–∞–Ω–¥—ã

### –ó–∞–ø—É—Å–∫ –≤ Docker
```bash
# –°–±–æ—Ä–∫–∞
docker-compose build

# –ó–∞–ø—É—Å–∫ –≤—Å–µ—Ö —Å–µ—Ä–≤–∏—Å–æ–≤
docker-compose up -d

# –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ –≤–æ—Ä–∫–µ—Ä–æ–≤
docker-compose up -d --scale classification-worker-1=3
docker-compose up -d --scale classification-worker-stage2-1=2

# –õ–æ–≥–∏
docker-compose logs -f classification-worker-1
```

## ‚ö° –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏

1. **–£–≤–µ–ª–∏—á—å—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –≤–æ—Ä–∫–µ—Ä–æ–≤** –¥–ª—è –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –º–æ–¥–µ–ª—å claude-3-haiku** –¥–ª—è —Å–∫–æ—Ä–æ—Å—Ç–∏
3. **–ù–∞—Å—Ç—Ä–æ–π—Ç–µ –ø—Ä–æ–∫—Å–∏** –µ—Å–ª–∏ –µ—Å—Ç—å –ø—Ä–æ–±–ª–µ–º—ã —Å –¥–æ—Å—Ç—É–ø–æ–º –∫ API
4. **–£–º–µ–Ω—å—à–∏—Ç–µ batch_size** –ø—Ä–∏ rate limits

## üìä –≠–∫—Å–ø–æ—Ä—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏:
```bash
# –ê–Ω–∞–ª–∏–∑ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤
make analyze

# –≠–∫—Å–ø–æ—Ä—Ç –≤ Excel
make export-excel
```

–§–∞–π–ª –±—É–¥–µ—Ç —Å–æ—Ö—Ä–∞–Ω–µ–Ω –≤ `exports/okpd2_results_YYYYMMDD_HHMMSS.xlsx`